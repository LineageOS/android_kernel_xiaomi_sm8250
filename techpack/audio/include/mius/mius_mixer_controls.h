#pragma once
#include <sound/core.h>
#include <sound/pcm.h>
#include <sound/soc.h>
#include <linux/types.h>


#define MIUS_OBJ_ID_CALIBRATION_DATA 1
#define MIUS_OBJ_ID_VERSION_INFO 2
#define MIUS_OBJ_ID_BRANCH_INFO 3
#define MIUS_OBJ_ID_CALIBRATION_V2_DATA 4
#define MIUS_OBJ_ID_DIAGNOSTICS_DATA 5
#define MIUS_OBJ_ID_TAG_INFO 6
#define MIUS_OBJ_ID_ML_DATA 7

#define MIUS_SYSTEM_CONFIGURATION_SIZE		96
#define MIUS_CALIBRATION_DATA_SIZE          64
#define MIUS_CALIBRATION_FLOAT_DATA_SIZE    56
#define MIUS_CALIBRATION_V2_DATA_SIZE      448
#define MIUS_DIAGNOSTICS_DATA_SIZE         448
#define MIUS_DIAGNOSTICS_U32_DATA_VALUES   (MIUS_DIAGNOSTICS_DATA_SIZE>>2)
#define MIUS_SENSOR_DATA_SIZE              68
#define MIUS_SENSOR_U32_DATA_VALUES   (MIUS_SENSOR_DATA_SIZE>>2)
#define MIUS_VERSION_INFO_SIZE              16
#define MIUS_BRANCH_INFO_SIZE               32
#define MIUS_BRANCH_INFO_MAX_SIZE          128
#define MIUS_TAG_INFO_SIZE                  32
#define MIUS_ML_DATA_SIZE				   432

#define MIUS_ULTRASOUND_DISABLE             0
#define MIUS_ULTRASOUND_ENABLE              1
#define MIUS_ULTRASOUND_SET_PARAMS          2
#define MIUS_ULTRASOUND_GET_PARAMS          3
#define MIUS_ULTRASOUND_DEBUG_LEVEL         4
#define MIUS_ULTRASOUND_RAMP_DOWN           5
#define MIUS_ULTRASOUND_SUSPEND             6
#define MIUS_ULTRASOUND_CL_DATA             7
#define MIUS_ULTRASOUND_MODE                8
#define MIUS_ULTRASOUND_UPLOAD_NONE         9

/** register */
#define MIUS_CALIBRATION				1
/** bits */
#define MIUS_CALIBRATION_STATE			0
#define MIUS_CALIBRATION_PROFILE		1
#define MIUS_ULTRASOUND_GAIN			2

/** custom settings */
#define MIUS_SYSTEM_CONFIGURATION_CUSTOM_SETTING_COUNT 16
#define MIUS_SYSTEM_CONFIGURATION_CUSTOM_SETTING_MAX_VALUE 0x7FFFFFFF

/** register */
#define MIUS_SYSTEM_CONFIGURATION			0
/** bits */
#define MIUS_SYSTEM_CONFIGURATION_LATENCY		0
#define MIUS_SYSTEM_CONFIGURATION_SENSITIVITY	1
#define MIUS_SYSTEM_CONFIGURATION_SPEAKER_SCALING	2
#define MIUS_SYSTEM_CONFIGURATION_MICROPHONE_INDEX	3
#define MIUS_SYSTEM_CONFIGURATION_OPERATION_MODE		4
#define MIUS_SYSTEM_CONFIGURATION_OPERATION_MODE_FLAGS	5
#define MIUS_SYSTEM_CONFIGURATION_LOG_LEVEL	6
#define MIUS_SYSTEM_CONFIGURATION_CUSTOM_SETTING_0	7
#define MIUS_SYSTEM_CONFIGURATION_CUSTOM_SETTING_1	8
#define MIUS_SYSTEM_CONFIGURATION_CUSTOM_SETTING_2	9
#define MIUS_SYSTEM_CONFIGURATION_CUSTOM_SETTING_3	10
#define MIUS_SYSTEM_CONFIGURATION_CUSTOM_SETTING_4	11
#define MIUS_SYSTEM_CONFIGURATION_CUSTOM_SETTING_5	12
#define MIUS_SYSTEM_CONFIGURATION_CUSTOM_SETTING_6	13
#define MIUS_SYSTEM_CONFIGURATION_CUSTOM_SETTING_7	14
#define MIUS_SYSTEM_CONFIGURATION_CUSTOM_SETTING_8	15
#define MIUS_SYSTEM_CONFIGURATION_CUSTOM_SETTING_9	16
#define MIUS_SYSTEM_CONFIGURATION_CUSTOM_SETTING_10	17
#define MIUS_SYSTEM_CONFIGURATION_CUSTOM_SETTING_11	18
#define MIUS_SYSTEM_CONFIGURATION_CUSTOM_SETTING_12	19
#define MIUS_SYSTEM_CONFIGURATION_CUSTOM_SETTING_13	20
#define MIUS_SYSTEM_CONFIGURATION_CUSTOM_SETTING_14	21
#define MIUS_SYSTEM_CONFIGURATION_CUSTOM_SETTING_15	22

#define MIUS_SYSTEM_CONFIGURATION_SUSPEND 23
#define MIUS_SYSTEM_CONFIGURATION_INPUT_ENABLED 24
#define MIUS_SYSTEM_CONFIGURATION_OUTPUT_ENABLED 25
#define MIUS_SYSTEM_CONFIGURATION_EXTERNAL_EVENT 26
#define MIUS_SYSTEM_CONFIGURATION_CALIBRATION_METHOD 27
#define MIUS_SYSTEM_CONFIGURATION_DEBUG_MODE 28
#define MIUS_SYSTEM_CONFIGURATION_NUMBER_OF_RUNS 29
#define MIUS_SYSTEM_CONFIGURATION_CONTEXT 30
#define MIUS_SYSTEM_CONFIGURATION_CAPTURE 31
#define MIUS_SYSTEM_CONFIGURATION_INPUT_CHANNELS 32
#define MIUS_SYSTEM_CONFIGURATION_REPORT_NONE 33
#define MIUS_SYSTEM_CONFIGURATION_RX_DEVICE 34

#define MIUS_SYSTEM_CONFIGURATION_MAX_CONTEXT_VALUE 0x7FFFFFFF


struct mius_engine_version_info {
	uint32_t major;
	uint32_t minor;
	uint32_t build;
	uint32_t revision;
};

struct mius_shared_data_block {
	uint32_t object_id;
	size_t size;
	void *buffer;
};

struct mius_shared_data_block *mius_get_shared_obj(uint32_t
	object_id);

extern unsigned int mius_add_component_controls(void *component);

void mius_set_calibration_data(uint8_t *calib_data, size_t size);

enum mius_system_configuration_parameter_type {

	MSC_SPEAKER_SCALING = 1,
	MSC_CHANNEL_SENSITIVITY,
	MSC_LATENCY,
	MSC_MICROPHONE_INDEX,
	MSC_OPERATION_MODE,
	MSC_OPERATION_MODE_FLAGS,
	MSC_COMPONENT_GAIN_CHANGE,
	MSC_CALIBRATION_STATE,
	MSC_ENGINE_VERSION,
	MSC_CALIBRATION_PROFILE,
	MSC_ULTRASOUND_GAIN,
	MSC_LOG_LEVEL,
	MSC_BUILD_BRANCH, //13

	MSC_FSELECTION,
	MSC_ENGINE_DIAGNOSTICS,
	MSC_ENGINE_CUSTOM_SETTING_0,
	MSC_ENGINE_CUSTOM_SETTING_1,
	MSC_ENGINE_CUSTOM_SETTING_2,
	MSC_ENGINE_CUSTOM_SETTING_3,
	MSC_ENGINE_CUSTOM_SETTING_4,
	MSC_ENGINE_CUSTOM_SETTING_5,
	MSC_ENGINE_CUSTOM_SETTING_6,
	MSC_ENGINE_CUSTOM_SETTING_7,
	MSC_ENGINE_CUSTOM_SETTING_8,
	MSC_ENGINE_CUSTOM_SETTING_9,
	MSC_ENGINE_CUSTOM_SETTING_10,
	MSC_ENGINE_CUSTOM_SETTING_11,
	MSC_ENGINE_CUSTOM_SETTING_12,
	MSC_ENGINE_CUSTOM_SETTING_13,
	MSC_ENGINE_CUSTOM_SETTING_14,
	MSC_ENGINE_CUSTOM_SETTING_15,
	MSC_SUSPEND, // 32
	MSC_INPUT_ENABLED,
	MSC_OUTPUT_ENABLED,
	MSC_EXTERNAL_EVENT,
	MSC_ENGINE_TAG, //36
	MSC_CALIBRATION_METHOD,
	MSC_DEBUG_MODE,
	MSC_NUMBER_OF_RUNS,
	MSC_CONTEXT,
	MSC_CAPTURE,
	MSC_INPUT_CHANNELS,
	MSC_RX_DEVICE
};

struct mius_system_configuration_parameters_cache {
	int32_t speaker_scaling[2];
	int32_t sensitivity;
	int32_t latency;
	int32_t microphone_index;
	int32_t operation_mode;
	int32_t operation_mode_flags;
	int32_t component_gain_change;
	int32_t calibration_state;
	int32_t engine_version;
	int32_t calibration_profile;
	int32_t ultrasound_gain;
	int32_t	log_level;
	int32_t custom_settings[MIUS_SYSTEM_CONFIGURATION_CUSTOM_SETTING_COUNT];
	int32_t engine_suspend;
	int32_t input_enabled;
	int32_t output_enabled;
	int32_t external_event;
	int32_t calibration_method;
	int32_t debug_mode;
	int32_t number_of_runs;
	int32_t context;
	int32_t capture;
	int32_t input_channels;
	int32_t rx_device;
};


int mius_trigger_version_msg(void);

int mius_trigger_branch_msg(void);

int mius_trigger_tag_msg(void);

int mius_trigger_diagnostics_msg(void);
